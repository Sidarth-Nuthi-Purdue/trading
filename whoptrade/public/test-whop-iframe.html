<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Whop Iframe Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    h1 {
      color: #5046e5;
      margin-top: 0;
    }
    iframe {
      width: 100%;
      height: 800px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .controls {
      margin-bottom: 20px;
      padding: 15px;
      background-color: #f0f0f0;
      border-radius: 4px;
    }
    button {
      background-color: #5046e5;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background-color: #3c35b5;
    }
    input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-right: 10px;
      width: 300px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Whop Iframe Test Environment</h1>
    <p>This page simulates how your app will appear when embedded in a Whop iframe.</p>
    
    <div class="controls">
      <h3>Test Controls</h3>
      <div style="margin-bottom: 10px;">
        <input type="text" id="tokenInput" placeholder="Enter mock Whop dev token" value="mockWhopToken123">
        <button onclick="loadWithToken()">Load with Token</button>
      </div>
      
      <div>
        <button onclick="sendUserData()">Send Mock User Data</button>
        <button onclick="clearTokens()">Clear Tokens</button>
      </div>
    </div>
    
    <iframe id="appFrame" src="/test-whop-auth"></iframe>
  </div>

  <script>
    // Function to load the iframe with a token
    function loadWithToken() {
      const token = document.getElementById('tokenInput').value;
      if (!token) {
        alert('Please enter a token');
        return;
      }
      
      const iframe = document.getElementById('appFrame');
      iframe.src = `/test-whop-auth?whop-dev-user-token=${encodeURIComponent(token)}`;
    }
    
    // Function to send mock user data to the iframe
    function sendUserData() {
      const iframe = document.getElementById('appFrame');
      const mockUser = {
        id: "user_9tkUCKXhITyCG",
        name: "Test User",
        username: "testuser",
        profilePicture: {
          sourceUrl: "https://cdn.discordapp.com/avatars/773984143276769341/49d1eae8364f767c8c12e59b19101ed2"
        },
        phoneVerified: false,
        city: "Boston",
        country: "US",
        bio: null,
        banner: null,
        createdAt: Date.now()
      };
      
      const mockExperience = {
        id: "exp_0nzaoQGLShrbRK",
        name: "PaperTrader",
        description: "Paper trading platform for Whop users",
        logo: {
          sourceUrl: "https://pub-a1dc6f8107c2492a8769db1059666e2f.r2.dev/custom-perk-icon.svg"
        },
        app: {
          id: "app_bPQ2OhdUYFDmQh",
          name: "PaperTrader",
          icon: {
            sourceUrl: "https://assets-2-prod.whop.com/uploads/user_9335555/image/apps/2025-06-08/83e3c750-6b18-44a4-b78d-9ad26c1f0e89"
          }
        },
        company: {
          id: "biz_8dQqiej4LyLE2a",
          title: "dannywchen3's whop"
        },
        upsellType: null,
        upsellPlan: null
      };
      
      // Send the mock data to the iframe
      iframe.contentWindow.postMessage({
        user: mockUser,
        experience: mockExperience,
        accessLevel: "admin",
        token: document.getElementById('tokenInput').value
      }, '*');
    }
    
    // Function to clear tokens
    function clearTokens() {
      const iframe = document.getElementById('appFrame');
      iframe.contentWindow.postMessage({
        clearTokens: true
      }, '*');
      
      // Reload the iframe
      setTimeout(() => {
        iframe.src = '/test-whop-auth';
      }, 500);
    }
  </script>
</body>
</html> 